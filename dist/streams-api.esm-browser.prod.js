import t from"util";var e,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function n(t,e,r,n){return new(r||(r=Promise))((function(s,o){function i(t){try{c(n.next(t))}catch(e){o(e)}}function a(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,a)}c((n=n.apply(t,e||[])).next())}))}!function(t){!function(e){var n="object"==typeof r?r:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),s=o(t);function o(t,e){return function(r,n){"function"!=typeof t[r]&&Object.defineProperty(t,r,{configurable:!0,writable:!0,value:n}),e&&e(r,n)}}void 0===n.Reflect?n.Reflect=t:s=o(n.Reflect,s),function(t){var e=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,i={__proto__:[]}instanceof Array,a=!o&&!i,c={create:o?function(){return nt(Object.create(null))}:i?function(){return nt({__proto__:null})}:function(){return nt({})},has:a?function(t,r){return e.call(t,r)}:function(t,e){return e in t},get:a?function(t,r){return e.call(t,r)?t[r]:void 0}:function(t,e){return t[e]}},u=Object.getPrototypeOf(Function),h="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,l=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?tt():Map,p=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?et():Set,f=new(h||"function"!=typeof WeakMap?rt():WeakMap);function d(t,e,r,n){if(L(r)){if(!z(t))throw new TypeError;if(!B(e))throw new TypeError;return k(t,e)}if(!z(t))throw new TypeError;if(!q(e))throw new TypeError;if(!q(n)&&!L(n)&&!D(n))throw new TypeError;return D(n)&&(n=void 0),R(t,e,r=F(r),n)}function y(t,e){function r(r,n){if(!q(r))throw new TypeError;if(!L(n)&&!X(n))throw new TypeError;j(t,e,r,n)}return r}function _(t,e,r,n){if(!q(r))throw new TypeError;return L(n)||(n=F(n)),j(t,e,r,n)}function v(t,e,r){if(!q(e))throw new TypeError;return L(r)||(r=F(r)),x(t,e,r)}function g(t,e,r){if(!q(e))throw new TypeError;return L(r)||(r=F(r)),A(t,e,r)}function m(t,e,r){if(!q(e))throw new TypeError;return L(r)||(r=F(r)),P(t,e,r)}function w(t,e,r){if(!q(e))throw new TypeError;return L(r)||(r=F(r)),T(t,e,r)}function b(t,e){if(!q(t))throw new TypeError;return L(e)||(e=F(e)),S(t,e)}function E(t,e){if(!q(t))throw new TypeError;return L(e)||(e=F(e)),I(t,e)}function $(t,e,r){if(!q(e))throw new TypeError;L(r)||(r=F(r));var n=O(e,r,!1);if(L(n))return!1;if(!n.delete(t))return!1;if(n.size>0)return!0;var s=f.get(e);return s.delete(r),s.size>0||f.delete(e),!0}function k(t,e){for(var r=t.length-1;r>=0;--r){var n=(0,t[r])(e);if(!L(n)&&!D(n)){if(!B(n))throw new TypeError;e=n}}return e}function R(t,e,r,n){for(var s=t.length-1;s>=0;--s){var o=(0,t[s])(e,r,n);if(!L(o)&&!D(o)){if(!q(o))throw new TypeError;n=o}}return n}function O(t,e,r){var n=f.get(t);if(L(n)){if(!r)return;n=new l,f.set(t,n)}var s=n.get(e);if(L(s)){if(!r)return;s=new l,n.set(e,s)}return s}function x(t,e,r){if(A(t,e,r))return!0;var n=Z(e);return!D(n)&&x(t,n,r)}function A(t,e,r){var n=O(e,r,!1);return!L(n)&&H(n.has(t))}function P(t,e,r){if(A(t,e,r))return T(t,e,r);var n=Z(e);return D(n)?void 0:P(t,n,r)}function T(t,e,r){var n=O(e,r,!1);if(!L(n))return n.get(t)}function j(t,e,r,n){O(r,n,!0).set(t,e)}function S(t,e){var r=I(t,e),n=Z(t);if(null===n)return r;var s=S(n,e);if(s.length<=0)return r;if(r.length<=0)return s;for(var o=new p,i=[],a=0,c=r;a<c.length;a++){o.has(l=c[a])||(o.add(l),i.push(l))}for(var u=0,h=s;u<h.length;u++){var l;o.has(l=h[u])||(o.add(l),i.push(l))}return i}function I(t,e){var r=[],n=O(t,e,!1);if(L(n))return r;for(var s=V(n.keys()),o=0;;){var i=J(s);if(!i)return r.length=o,r;var a=Y(i);try{r[o]=a}catch(c){try{Q(s)}finally{throw c}}o++}}function C(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function L(t){return void 0===t}function D(t){return null===t}function M(t){return"symbol"==typeof t}function q(t){return"object"==typeof t?null!==t:"function"==typeof t}function U(t,e){switch(C(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var r=3===e?"string":5===e?"number":"default",s=G(t,n);if(void 0!==s){var o=s.call(t,r);if(q(o))throw new TypeError;return o}return W(t,"default"===r?"number":r)}function W(t,e){if("string"===e){var r=t.toString;if(K(r))if(!q(s=r.call(t)))return s;if(K(n=t.valueOf))if(!q(s=n.call(t)))return s}else{var n;if(K(n=t.valueOf))if(!q(s=n.call(t)))return s;var s,o=t.toString;if(K(o))if(!q(s=o.call(t)))return s}throw new TypeError}function H(t){return!!t}function N(t){return""+t}function F(t){var e=U(t,3);return M(e)?e:N(e)}function z(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function K(t){return"function"==typeof t}function B(t){return"function"==typeof t}function X(t){switch(C(t)){case 3:case 4:return!0;default:return!1}}function G(t,e){var r=t[e];if(null!=r){if(!K(r))throw new TypeError;return r}}function V(t){var e=G(t,s);if(!K(e))throw new TypeError;var r=e.call(t);if(!q(r))throw new TypeError;return r}function Y(t){return t.value}function J(t){var e=t.next();return!e.done&&e}function Q(t){var e=t.return;e&&e.call(t)}function Z(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===u)return e;if(e!==u)return e;var r=t.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return e;var s=n.constructor;return"function"!=typeof s||s===t?e:s}function tt(){var t={},e=[],r=function(){function t(t,e,r){this._index=0,this._keys=t,this._values=e,this._selector=r}return t.prototype["@@iterator"]=function(){return this},t.prototype[s]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var r=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var r=this._find(t,!0);return this._values[r]=e,this},e.prototype.delete=function(e){var r=this._find(e,!1);if(r>=0){for(var n=this._keys.length,s=r+1;s<n;s++)this._keys[s-1]=this._keys[s],this._values[s-1]=this._values[s];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new r(this._keys,this._values,n)},e.prototype.values=function(){return new r(this._keys,this._values,o)},e.prototype.entries=function(){return new r(this._keys,this._values,i)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[s]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function n(t,e){return t}function o(t,e){return e}function i(t,e){return[t,e]}}function et(){return function(){function t(){this._map=new l}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[s]=function(){return this.keys()},t}()}function rt(){var t=16,r=c.create(),n=s();return function(){function t(){this._key=s()}return t.prototype.has=function(t){var e=o(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=o(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return o(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=o(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=s()},t}();function s(){var t;do{t="@@WeakMap@@"+u()}while(c.has(r,t));return r[t]=!0,t}function o(t,r){if(!e.call(t,n)){if(!r)return;Object.defineProperty(t,n,{value:c.create()})}return t[n]}function i(t,e){for(var r=0;r<e;++r)t[r]=255*Math.random()|0;return t}function a(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):i(new Uint8Array(t),t):i(new Array(t),t)}function u(){var e=a(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var r="",n=0;n<t;++n){var s=e[n];4!==n&&6!==n&&8!==n||(r+="-"),s<16&&(r+="0"),r+=s.toString(16).toLowerCase()}return r}}function nt(t){return t.__=void 0,delete t.__,t}t("decorate",d),t("metadata",y),t("defineMetadata",_),t("hasMetadata",v),t("hasOwnMetadata",g),t("getMetadata",m),t("getOwnMetadata",w),t("getMetadataKeys",b),t("getOwnMetadataKeys",E),t("deleteMetadata",$)}(s)}()}(e||(e={}));var s=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===o}(t)}(t)};var o="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(t,e){return!1!==e.clone&&e.isMergeableObject(t)?l(Array.isArray(t)?[]:{},t,e):t}function a(t,e,r){return t.concat(e).map((function(t){return i(t,r)}))}function c(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function u(t,e){try{return e in t}catch(r){return!1}}function h(t,e,r){var n={};return r.isMergeableObject(t)&&c(t).forEach((function(e){n[e]=i(t[e],r)})),c(e).forEach((function(s){(function(t,e){return u(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,s)||(n[s]=u(t,s)&&r.isMergeableObject(e[s])?function(t,e){if(!e.customMerge)return l;var r=e.customMerge(t);return"function"==typeof r?r:l}(s,r)(t[s],e[s],r):i(e[s],r))})),n}function l(t,e,r){(r=r||{}).arrayMerge=r.arrayMerge||a,r.isMergeableObject=r.isMergeableObject||s,r.cloneUnlessOtherwiseSpecified=i;var n=Array.isArray(e);return n===Array.isArray(t)?n?r.arrayMerge(t,e,r):h(t,e,r):i(e,r)}l.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,r){return l(t,r,e)}),{})};var p=l;const f=t.deprecate((()=>{}),"Hook.context is deprecated and will be removed"),d=function(...t){return this.call=this._createCall("sync"),this.call(...t)},y=function(...t){return this.callAsync=this._createCall("async"),this.callAsync(...t)},_=function(...t){return this.promise=this._createCall("promise"),this.promise(...t)};class v{constructor(t=[],e){this._args=t,this.name=e,this.taps=[],this.interceptors=[],this._call=d,this.call=d,this._callAsync=y,this.callAsync=y,this._promise=_,this.promise=_,this._x=void 0,this.compile=this.compile,this.tap=this.tap,this.tapAsync=this.tapAsync,this.tapPromise=this.tapPromise}compile(t){throw new Error("Abstract: should be overridden")}_createCall(t){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:t})}_tap(t,e,r){if("string"==typeof e)e={name:e.trim()};else if("object"!=typeof e||null===e)throw new Error("Invalid tap options");if("string"!=typeof e.name||""===e.name)throw new Error("Missing name for tap");void 0!==e.context&&f(),e=Object.assign({type:t,fn:r},e),e=this._runRegisterInterceptors(e),this._insert(e)}tap(t,e){this._tap("sync",t,e)}tapAsync(t,e){this._tap("async",t,e)}tapPromise(t,e){this._tap("promise",t,e)}_runRegisterInterceptors(t){for(const e of this.interceptors)if(e.register){const r=e.register(t);void 0!==r&&(t=r)}return t}withOptions(t){const e=e=>Object.assign({},t,"string"==typeof e?{name:e}:e);return{name:this.name,tap:(t,r)=>this.tap(e(t),r),tapAsync:(t,r)=>this.tapAsync(e(t),r),tapPromise:(t,r)=>this.tapPromise(e(t),r),intercept:t=>this.intercept(t),isUsed:()=>this.isUsed(),withOptions:t=>this.withOptions(e(t))}}isUsed(){return this.taps.length>0||this.interceptors.length>0}intercept(t){if(this._resetCompilation(),this.interceptors.push(Object.assign({},t)),t.register)for(let e=0;e<this.taps.length;e++)this.taps[e]=t.register(this.taps[e])}_resetCompilation(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}_insert(t){let e;this._resetCompilation(),"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let r=0;"number"==typeof t.stage&&(r=t.stage);let n=this.taps.length;for(;n>0;){n--;const t=this.taps[n];this.taps[n+1]=t;const s=t.stage||0;if(e){if(e.has(t.name)){e.delete(t.name);continue}if(e.size>0)continue}if(!(s>r)){n++;break}}this.taps[n]=t}}Object.setPrototypeOf(v.prototype,null);var g=v;var m=class{constructor(t){this.config=t,this.options=void 0,this._args=void 0}create(t){let e;switch(this.init(t),this.options.type){case"sync":e=new Function(this.args(),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:t=>`throw ${t};\n`,onResult:t=>`return ${t};\n`,resultReturns:!0,onDone:()=>"",rethrowIfPossible:!0}));break;case"async":e=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:t=>`_callback(${t});\n`,onResult:t=>`_callback(null, ${t});\n`,onDone:()=>"_callback();\n"}));break;case"promise":let t=!1;const r=this.contentWithInterceptors({onError:e=>(t=!0,`_error(${e});\n`),onResult:t=>`_resolve(${t});\n`,onDone:()=>"_resolve();\n"});let n="";n+='"use strict";\n',n+=this.header(),n+="return new Promise((function(_resolve, _reject) {\n",t&&(n+="var _sync = true;\n",n+="function _error(_err) {\n",n+="if(_sync)\n",n+="_resolve(Promise.resolve().then((function() { throw _err; })));\n",n+="else\n",n+="_reject(_err);\n",n+="};\n"),n+=r,t&&(n+="_sync = false;\n"),n+="}));\n",e=new Function(this.args(),n)}return this.deinit(),e}setup(t,e){t._x=e.taps.map((t=>t.fn))}init(t){this.options=t,this._args=t.args.slice()}deinit(){this.options=void 0,this._args=void 0}contentWithInterceptors(t){if(this.options.interceptors.length>0){const e=t.onError,r=t.onResult,n=t.onDone;let s="";for(let t=0;t<this.options.interceptors.length;t++){const e=this.options.interceptors[t];e.call&&(s+=`${this.getInterceptor(t)}.call(${this.args({before:e.context?"_context":void 0})});\n`)}return s+=this.content(Object.assign(t,{onError:e&&(t=>{let r="";for(let e=0;e<this.options.interceptors.length;e++){this.options.interceptors[e].error&&(r+=`${this.getInterceptor(e)}.error(${t});\n`)}return r+=e(t),r}),onResult:r&&(t=>{let e="";for(let r=0;r<this.options.interceptors.length;r++){this.options.interceptors[r].result&&(e+=`${this.getInterceptor(r)}.result(${t});\n`)}return e+=r(t),e}),onDone:n&&(()=>{let t="";for(let e=0;e<this.options.interceptors.length;e++){this.options.interceptors[e].done&&(t+=`${this.getInterceptor(e)}.done();\n`)}return t+=n(),t})})),s}return this.content(t)}header(){let t="";return this.needContext()?t+="var _context = {};\n":t+="var _context;\n",t+="var _x = this._x;\n",this.options.interceptors.length>0&&(t+="var _taps = this.taps;\n",t+="var _interceptors = this.interceptors;\n"),t}needContext(){for(const t of this.options.taps)if(t.context)return!0;return!1}callTap(t,{onError:e,onResult:r,onDone:n,rethrowIfPossible:s}){let o="",i=!1;for(let c=0;c<this.options.interceptors.length;c++){const e=this.options.interceptors[c];e.tap&&(i||(o+=`var _tap${t} = ${this.getTap(t)};\n`,i=!0),o+=`${this.getInterceptor(c)}.tap(${e.context?"_context, ":""}_tap${t});\n`)}o+=`var _fn${t} = ${this.getTapFn(t)};\n`;const a=this.options.taps[t];switch(a.type){case"sync":s||(o+=`var _hasError${t} = false;\n`,o+="try {\n"),o+=r?`var _result${t} = _fn${t}(${this.args({before:a.context?"_context":void 0})});\n`:`_fn${t}(${this.args({before:a.context?"_context":void 0})});\n`,s||(o+="} catch(_err) {\n",o+=`_hasError${t} = true;\n`,o+=e("_err"),o+="}\n",o+=`if(!_hasError${t}) {\n`),r&&(o+=r(`_result${t}`)),n&&(o+=n()),s||(o+="}\n");break;case"async":let i="";i+=r?`(function(_err${t}, _result${t}) {\n`:`(function(_err${t}) {\n`,i+=`if(_err${t}) {\n`,i+=e(`_err${t}`),i+="} else {\n",r&&(i+=r(`_result${t}`)),n&&(i+=n()),i+="}\n",i+="})",o+=`_fn${t}(${this.args({before:a.context?"_context":void 0,after:i})});\n`;break;case"promise":o+=`var _hasResult${t} = false;\n`,o+=`var _promise${t} = _fn${t}(${this.args({before:a.context?"_context":void 0})});\n`,o+=`if (!_promise${t} || !_promise${t}.then)\n`,o+=`  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise${t} + ')');\n`,o+=`_promise${t}.then((function(_result${t}) {\n`,o+=`_hasResult${t} = true;\n`,r&&(o+=r(`_result${t}`)),n&&(o+=n()),o+=`}), function(_err${t}) {\n`,o+=`if(_hasResult${t}) throw _err${t};\n`,o+=e(`_err${t}`),o+="});\n"}return o}callTapsSeries({onError:t,onResult:e,resultReturns:r,onDone:n,doneReturns:s,rethrowIfPossible:o}){if(0===this.options.taps.length)return n();const i=this.options.taps.findIndex((t=>"sync"!==t.type)),a=r||s;let c="",u=n,h=0;for(let l=this.options.taps.length-1;l>=0;l--){const r=l;u!==n&&("sync"!==this.options.taps[r].type||h++>20)&&(h=0,c+=`function _next${r}() {\n`,c+=u(),c+="}\n",u=()=>`${a?"return ":""}_next${r}();\n`);const s=u,p=t=>t?"":n(),f=this.callTap(r,{onError:e=>t(r,e,s,p),onResult:e&&(t=>e(r,t,s,p)),onDone:!e&&s,rethrowIfPossible:o&&(i<0||r<i)});u=()=>f}return c+=u(),c}callTapsLooping({onError:t,onDone:e,rethrowIfPossible:r}){if(0===this.options.taps.length)return e();const n=this.options.taps.every((t=>"sync"===t.type));let s="";n||(s+="var _looper = (function() {\n",s+="var _loopAsync = false;\n"),s+="var _loop;\n",s+="do {\n",s+="_loop = false;\n";for(let o=0;o<this.options.interceptors.length;o++){const t=this.options.interceptors[o];t.loop&&(s+=`${this.getInterceptor(o)}.loop(${this.args({before:t.context?"_context":void 0})});\n`)}return s+=this.callTapsSeries({onError:t,onResult:(t,e,r,s)=>{let o="";return o+=`if(${e} !== undefined) {\n`,o+="_loop = true;\n",n||(o+="if(_loopAsync) _looper();\n"),o+=s(!0),o+="} else {\n",o+=r(),o+="}\n",o},onDone:e&&(()=>{let t="";return t+="if(!_loop) {\n",t+=e(),t+="}\n",t}),rethrowIfPossible:r&&n}),s+="} while(_loop);\n",n||(s+="_loopAsync = true;\n",s+="});\n",s+="_looper();\n"),s}callTapsParallel({onError:t,onResult:e,onDone:r,rethrowIfPossible:n,onTap:s=((t,e)=>e())}){if(this.options.taps.length<=1)return this.callTapsSeries({onError:t,onResult:e,onDone:r,rethrowIfPossible:n});let o="";o+="do {\n",o+=`var _counter = ${this.options.taps.length};\n`,r&&(o+="var _done = (function() {\n",o+=r(),o+="});\n");for(let i=0;i<this.options.taps.length;i++){const a=()=>r?"if(--_counter === 0) _done();\n":"--_counter;",c=t=>t||!r?"_counter = 0;\n":"_counter = 0;\n_done();\n";o+="if(_counter <= 0) break;\n",o+=s(i,(()=>this.callTap(i,{onError:e=>{let r="";return r+="if(_counter > 0) {\n",r+=t(i,e,a,c),r+="}\n",r},onResult:e&&(t=>{let r="";return r+="if(_counter > 0) {\n",r+=e(i,t,a,c),r+="}\n",r}),onDone:!e&&(()=>a()),rethrowIfPossible:n})),a,c)}return o+="} while(false);\n",o}args({before:t,after:e}={}){let r=this._args;return t&&(r=[t].concat(r)),e&&(r=r.concat(e)),0===r.length?"":r.join(", ")}getTapFn(t){return`_x[${t}]`}getTap(t){return`_taps[${t}]`}getInterceptor(t){return`_interceptors[${t}]`}};const w=g,b=m;const E=new class extends b{content({onError:t,onDone:e,rethrowIfPossible:r}){return this.callTapsSeries({onError:(e,r)=>t(r),onDone:e,rethrowIfPossible:r})}},$=()=>{throw new Error("tapAsync is not supported on a SyncHook")},k=()=>{throw new Error("tapPromise is not supported on a SyncHook")},R=function(t){return E.setup(this,t),E.create(t)};function O(t=[],e){const r=new w(t,e);return r.constructor=O,r.tapAsync=$,r.tapPromise=k,r.compile=R,r}O.prototype=null;var x=O;const A=m;new class extends A{content({onError:t,onResult:e,resultReturns:r,onDone:n,rethrowIfPossible:s}){return this.callTapsSeries({onError:(e,r)=>t(r),onResult:(t,r,n)=>`if(${r} !== undefined) {\n${e(r)};\n} else {\n${n()}}\n`,resultReturns:r,onDone:n,rethrowIfPossible:s})}};const P=g,T=m;const j=new class extends T{content({onError:t,onResult:e,resultReturns:r,rethrowIfPossible:n}){return this.callTapsSeries({onError:(e,r)=>t(r),onResult:(t,e,r)=>{let n="";return n+=`if(${e} !== undefined) {\n`,n+=`${this._args[0]} = ${e};\n`,n+="}\n",n+=r(),n},onDone:()=>e(this._args[0]),doneReturns:r,rethrowIfPossible:n})}},S=()=>{throw new Error("tapAsync is not supported on a SyncWaterfallHook")},I=()=>{throw new Error("tapPromise is not supported on a SyncWaterfallHook")},C=function(t){return j.setup(this,t),j.create(t)};function L(t=[],e){if(t.length<1)throw new Error("Waterfall hooks must have at least one argument");const r=new P(t,e);return r.constructor=L,r.tapAsync=S,r.tapPromise=I,r.compile=C,r}L.prototype=null;var D=L;const M=m;new class extends M{content({onError:t,onDone:e,rethrowIfPossible:r}){return this.callTapsLooping({onError:(e,r)=>t(r),onDone:e,rethrowIfPossible:r})}};const q=m;new class extends q{content({onError:t,onDone:e}){return this.callTapsParallel({onError:(e,r,n,s)=>t(r)+s(!0),onDone:e})}};const U=m;new class extends U{content({onError:t,onResult:e,onDone:r}){let n="";return n+=`var _results = new Array(${this.options.taps.length});\n`,n+="var _checkDone = function() {\n",n+="for(var i = 0; i < _results.length; i++) {\n",n+="var item = _results[i];\n",n+="if(item === undefined) return false;\n",n+="if(item.result !== undefined) {\n",n+=e("item.result"),n+="return true;\n",n+="}\n",n+="if(item.error) {\n",n+=t("item.error"),n+="return true;\n",n+="}\n",n+="}\n",n+="return false;\n",n+="}\n",n+=this.callTapsParallel({onError:(t,e,r,n)=>{let s="";return s+=`if(${t} < _results.length && ((_results.length = ${t+1}), (_results[${t}] = { error: ${e} }), _checkDone())) {\n`,s+=n(!0),s+="} else {\n",s+=r(),s+="}\n",s},onResult:(t,e,r,n)=>{let s="";return s+=`if(${t} < _results.length && (${e} !== undefined && (_results.length = ${t+1}), (_results[${t}] = { result: ${e} }), _checkDone())) {\n`,s+=n(!0),s+="} else {\n",s+=r(),s+="}\n",s},onTap:(t,e,r,n)=>{let s="";return t>0&&(s+=`if(${t} >= _results.length) {\n`,s+=r(),s+="} else {\n"),s+=e(),t>0&&(s+="}\n"),s},onDone:r}),n}};const W=m;new class extends W{content({onError:t,onDone:e}){return this.callTapsSeries({onError:(e,r,n,s)=>t(r)+s(!0),onDone:e})}};const H=m;new class extends H{content({onError:t,onResult:e,resultReturns:r,onDone:n}){return this.callTapsSeries({onError:(e,r,n,s)=>t(r)+s(!0),onResult:(t,r,n)=>`if(${r} !== undefined) {\n${e(r)}\n} else {\n${n()}}\n`,resultReturns:r,onDone:n})}};const N=m;new class extends N{content({onError:t,onDone:e}){return this.callTapsLooping({onError:(e,r,n,s)=>t(r)+s(!0),onDone:e})}};const F=g,z=m;const K=new class extends z{content({onError:t,onResult:e}){return this.callTapsSeries({onError:(e,r,n,s)=>t(r)+s(!0),onResult:(t,e,r)=>{let n="";return n+=`if(${e} !== undefined) {\n`,n+=`${this._args[0]} = ${e};\n`,n+="}\n",n+=r(),n},onDone:()=>e(this._args[0])})}},B=function(t){return K.setup(this,t),K.create(t)};function X(t=[],e){if(t.length<1)throw new Error("Waterfall hooks must have at least one argument");const r=new F(t,e);return r.constructor=X,r.compile=B,r._call=void 0,r.call=void 0,r}X.prototype=null;var G=X;const V=t,Y=(t,e)=>e;class J{constructor(t,e){this._map=new Map,this.name=e,this._factory=t,this._interceptors=[]}get(t){return this._map.get(t)}for(t){const e=this.get(t);if(void 0!==e)return e;let r=this._factory(t);const n=this._interceptors;for(let s=0;s<n.length;s++)r=n[s].factory(t,r);return this._map.set(t,r),r}intercept(t){this._interceptors.push(Object.assign({factory:Y},t))}}J.prototype.tap=V.deprecate((function(t,e,r){return this.for(t).tap(e,r)}),"HookMap#tap(key,…) is deprecated. Use HookMap#for(key).tap(…) instead."),J.prototype.tapAsync=V.deprecate((function(t,e,r){return this.for(t).tapAsync(e,r)}),"HookMap#tapAsync(key,…) is deprecated. Use HookMap#for(key).tapAsync(…) instead."),J.prototype.tapPromise=V.deprecate((function(t,e,r){return this.for(t).tapPromise(e,r)}),"HookMap#tapPromise(key,…) is deprecated. Use HookMap#for(key).tapPromise(…) instead.");var Q,Z=x,tt=D,et=G;!function(t){t.connect="CONNECT",t.delete="DELETE",t.get="GET",t.head="HEAD",t.options="OPTIONS",t.patch="PATCH",t.post="POST",t.put="PUT",t.trace="TRACE"}(Q||(Q={}));class rt extends Error{constructor(t,e){super(`HTTP ${t.status} Error: ${t.statusText}`),this.response=t,this.request=e,this.name="HTTPError"}}class nt{static random(t=15){let e="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<t;n++)e+=r.charAt(Math.floor(Math.random()*r.length));return e}static ensureLeft(t,e){return!1===t.startsWith(e)?e+t:t}static ensureRight(t,e){return!1===t.endsWith(e)?t+e:t}static stripLeft(t,e){return t.startsWith(e)?t.substr(e.length):t}static stripRight(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}static ucfirst(t){return t[0].toUpperCase()+t.slice(1)}static lcfirst(t){return t[0].toLowerCase()+t.slice(1)}static parameters(t,e){return Object.entries(e).forEach((([e,r])=>t=t.replace(new RegExp(":"+e,"g"),r))),t}}const st=(t,[e,r])=>Object.assign(Object.assign({},t),{[e]:r});var ot={exports:{}};const it=(t,e)=>{if("string"!=typeof t&&!Array.isArray(t))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},0===(t=Array.isArray(t)?t.map((t=>t.trim())).filter((t=>t.length)).join("-"):t.trim()).length)return"";if(1===t.length)return e.pascalCase?t.toLocaleUpperCase(e.locale):t.toLocaleLowerCase(e.locale);return t!==t.toLocaleLowerCase(e.locale)&&(t=((t,e)=>{let r=!1,n=!1,s=!1;for(let o=0;o<t.length;o++){const i=t[o];r&&/[\p{Lu}]/u.test(i)?(t=t.slice(0,o)+"-"+t.slice(o),r=!1,s=n,n=!0,o++):n&&s&&/[\p{Ll}]/u.test(i)?(t=t.slice(0,o-1)+"-"+t.slice(o-1),s=n,n=!1,r=!0):(r=i.toLocaleLowerCase(e)===i&&i.toLocaleUpperCase(e)!==i,s=n,n=i.toLocaleUpperCase(e)===i&&i.toLocaleLowerCase(e)!==i)}return t})(t,e.locale)),t=t.replace(/^[_.\- ]+/,""),t=e.preserveConsecutiveUppercase?(t=>t.replace(/^[\p{Lu}](?![\p{Lu}])/gu,(t=>t.toLowerCase())))(t):t.toLocaleLowerCase(),e.pascalCase&&(t=t.charAt(0).toLocaleUpperCase(e.locale)+t.slice(1)),((t,e)=>t.replace(/[_.\- ]+([\p{Alpha}\p{N}_]|$)/gu,((t,r)=>r.toLocaleUpperCase(e.locale))).replace(/\d+([\p{Alpha}\p{N}_]|$)/gu,(t=>t.toLocaleUpperCase(e.locale))))(t,e)};ot.exports=it,ot.exports.default=it;var at=ot.exports;class ct{constructor(t){this.hooks={createRequest:new tt(["factory"]),request:new tt(["request"]),response:new et(["response","request"])},this.config=p({headers:{"X-Requested-With":"XMLHttpRequest"},request:{method:"GET",credentials:"include"}},t)}request(t,e,r={}){return n(this,void 0,void 0,(function*(){let n=this.createRequest(t,e,r);n=this.hooks.request.call(n);let s=function(t){const e=t.clone();let r=Array.from(t.headers.entries());return Object.entries(p.all([r.map((([t,e])=>[at(t),e])).reduce(st,{}),r.map((([t,e])=>[t.split("-").map((t=>nt.ucfirst(t))).join("-"),e])).reduce(st,{}),r.reduce(st,{})])).forEach((([t,r])=>{e.headers[t]=r,e.headers.set(t,r)})),e}(yield fetch(n));if(s=yield this.hooks.response.promise(s,n),!s.ok)throw new rt(s,n);return s}))}createRequest(t,e,r={}){let n=this.createRequestFactory(t,e,r);return n.headers(this.config.headers),n=this.hooks.createRequest.call(n),n.make()}createRequestFactory(t,e,r={}){return(r=this.getRequestConfig(r)).method=Q[t],r.url=e,function(t,e=Request){return new ut(t,e)}(this.config).merge(r)}getRequestConfig(t={}){return p(this.config.request,t,{clone:!0})}}class ut{constructor(t,e){return this._clientConfig=t,this._Request=e,this._config={},this._params=new URLSearchParams,this._headers=new Headers,new Proxy(this,{get:(t,e,r)=>Reflect.has(t,e)?Reflect.get(t,e,r):r=>(t._config[e]=r,t),set:(t,e,r,n)=>"function"==typeof t[e]?t[e](r):Reflect.set(t,e,r,n)})}merge(t){return Object.entries(t).forEach((([t,e])=>this[t](e))),this}getConfig(){return Object.assign(Object.assign({},this._config),{headers:this._headers,params:this._params,url:this._config.url?this.getUri(this._config.url):this._config.url})}header(t,e){return this._headers.set(t,e),this}param(t,e){return this._headers.set(t,e),this}headers(t){var e;return e=this._headers,new Headers(t).forEach(((t,r)=>e.set(r,t))),this}params(t){var e;return e=this._params,new URLSearchParams(t).forEach(((t,r)=>e.set(r,t))),this}data(t){return this._headers.set("Content-Type","application/json"),this._config.body=JSON.stringify(t),this}getUri(t){let e=this._params.toString();return e.length&&(e="?"+e),nt.ensureRight(this._clientConfig.baseURL,"/")+nt.stripLeft(t,"/")+e}basic(t,e){return this.authorization("Basic",btoa(t+":"+e))}bearer(t){return this.authorization("Bearer",t)}authorization(t,e){return this._headers.set("Authorization",t+" "+e),this}make(){const t=this.getConfig();return new this._Request(t.url,t)}}class ht extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,Array.prototype)}}class lt{constructor(t,e={},r=!0){return this._stream=t,this._data=e,this._fresh=r,new Proxy(this,{get:(t,e,r)=>Reflect.has(t,e)?Reflect.get(t,e,r):Reflect.has(t._data,e)?Reflect.get(t._data,e):void 0,set:(t,e,r,n)=>Reflect.has(t,e)?Reflect.set(t,e,r,n):Reflect.set(t._data,e,r)})}get http(){return this._stream.streams.http}get stream(){return this._stream}save(){return n(this,void 0,void 0,(function*(){try{return this._fresh?(yield this.http.postEntry(this._stream.id,this._data),!0):(yield this.http.patchEntry(this._stream.id,this._data.id,this._data),!0)}catch(t){return!1}}))}validator(){}}class pt extends ht{constructor(t,e,r){super(...t),this.meta=e,this.links=r}static fromResponse(t,e){const r=Object.values(t.data).map((t=>new lt(e,t,!1)));return new pt(r,t.meta,t.links)}}class ft extends ht{constructor(t,e,r){super(...t),this.meta=e,this.links=r}static fromResponse(t,e){const r=Object.values(t.data).map((t=>new lt(e,t,!1)));return new ft(r,t.meta,t.links)}}const dt=[">","<","==","!=",">=","<=","!<","!>","<>"],yt=["BETWEEN","EXISTS","OR","AND","NOT","IN","ALL","ANY","LIKE","IS NULL","UNIQUE"],_t=[].concat(dt).concat(yt),vt=t=>_t.includes(t);class gt{constructor(t){this.stream=t,this.parameters=[]}get http(){return this.stream.streams.http}find(t){return n(this,void 0,void 0,(function*(){return this.where("id",t).first()}))}first(){return n(this,void 0,void 0,(function*(){return(yield this.limit(1).get())[0]}))}cache(){return this}orderBy(t,e="desc"){return this.addParameter("orderBy",[t,e]),this}limit(t){return this.addParameter("limit",t),this}where(...t){let e,r,n,s;if(2===t.length?(e=t[0],r="==",n=t[1]):3===t.length?(e=t[0],r=t[1],n=t[2]):4===t.length&&(e=t[0],r=t[1],n=t[2],s=t[3]),!vt(r))throw new Error(`Criteria where() operator "${r}" not valid `);return this.addParameter("where",[e,r,n,s]),this}orWhere(...t){let e,r,n;if(2===t.length?(e=t[0],r="==",n=t[1]):(e=t[0],r=t[1],n=t[2]),!vt(r))throw new Error(`Criteria orWhere() operator "${r}" not valid `);return this.addParameter("where",[e,r,n,"or"]),this}get(){return n(this,void 0,void 0,(function*(){let t=this.compileStatements();const e=yield this.http.getEntries(this.stream.id,{query:t},{});return pt.fromResponse(e,this.stream)}))}create(t){return n(this,void 0,void 0,(function*(){let e=this.newInstance(t);return yield e.save(),e}))}save(t){return n(this,void 0,void 0,(function*(){return yield t.save()}))}delete(){return this}paginate(t=100,e=1){return n(this,void 0,void 0,(function*(){let r=this.compileStatements();const n=yield this.http.getEntries(this.stream.id,{query:r},{paginate:!0,per_page:t,page:e});return ft.fromResponse(n,this.stream)}))}newInstance(t){return new lt(this.stream,t,!0)}getParameters(){return this.parameters}setParameters(t){return this.parameters=t,this}addParameter(t,e){return this.parameters.push({name:t,value:e}),this}compileStatements(){return this.parameters.map((t=>{return{[t.name]:(e=t.value,Array.isArray(e)?e:[e])};var e}))}}class mt{constructor(t){Object.assign(this,t)}}class wt extends ht{}class bt{constructor(t){this.streams=t}get client(){return this.streams.client}get config(){return this.streams.config}getStreams(t={},e={}){return n(this,void 0,void 0,(function*(){return e.params=t,this.get("/streams",e)}))}postStream(t,e={}){return n(this,void 0,void 0,(function*(){return this.post("/streams",t,e)}))}getStream(t,e={},r={}){return n(this,void 0,void 0,(function*(){return r.params=e,yield this.get(`/streams/${t}`,r)}))}patchStream(t,e={},r={}){return n(this,void 0,void 0,(function*(){return this.patch(`/streams/${t}`,e,r)}))}putStream(t,e={},r={}){return n(this,void 0,void 0,(function*(){return this.put(`/streams/${t}`,e,r)}))}deleteStream(t,e={}){return n(this,void 0,void 0,(function*(){return this.delete(`/streams/${t}`,e)}))}getEntries(t,e={},r={},s={}){return n(this,void 0,void 0,(function*(){return s.body=e,s.params=r,this.get(`/streams/${t}/entries`,Object.assign(Object.assign({},s),{headers:{"Content-Type":"application/json"}}))}))}postEntry(t,e={},r={}){return n(this,void 0,void 0,(function*(){return this.post(`/streams/${t}/entries`,e,r)}))}getEntry(t,e,r={}){return n(this,void 0,void 0,(function*(){return this.get(`/streams/${t}/entries/${e}`,r)}))}patchEntry(t,e,r={},s={}){return n(this,void 0,void 0,(function*(){return this.patch(`/streams/${t}/entries/${e}`,r,s)}))}putEntry(t,e,r={},s={}){return n(this,void 0,void 0,(function*(){return this.put(`/streams/${t}/entries/${e}`,r,s)}))}deleteEntry(t,e,r={}){return n(this,void 0,void 0,(function*(){return nt.parameters("/streams/:stream/entries/:entry",{stream:t,entry:e}),this.patch(`/streams/${t}/entries/${e}`,r)}))}get(t,e={}){return n(this,void 0,void 0,(function*(){return this.request("get",t,e)}))}delete(t,e={}){return n(this,void 0,void 0,(function*(){return this.request("delete",t,e)}))}head(t,e={}){return n(this,void 0,void 0,(function*(){return this.request("head",t,e)}))}options(t,e={}){return n(this,void 0,void 0,(function*(){return this.request("options",t,e)}))}post(t,e,r={}){return n(this,void 0,void 0,(function*(){return this.request("post",t,Object.assign({data:e},r))}))}put(t,e,r={}){return n(this,void 0,void 0,(function*(){return this.request("put",t,Object.assign({data:e},r))}))}patch(t,e,r={}){return n(this,void 0,void 0,(function*(){return this.request("patch",t,Object.assign({data:e},r))}))}request(t,e,r){return n(this,void 0,void 0,(function*(){try{return yield this.client.request(t,e,r)}catch(n){throw n}}))}}class Et{constructor(t){this.stream=t}get http(){return this.stream.streams.http}all(){return n(this,void 0,void 0,(function*(){let t=yield this.http.getEntries(this.stream.id),e=t.data.map((t=>new lt(this.stream,t,!1)));return new pt(e,t.meta,t.links)}))}find(t){return n(this,void 0,void 0,(function*(){return this.stream.entries().where("id",t).first()}))}findAll(t){return n(this,void 0,void 0,(function*(){return this.stream.entries().where("id","IN",t).get()}))}findBy(t,e){return n(this,void 0,void 0,(function*(){return this.stream.entries().where(t,e).first()}))}findAllWhere(t,e){return n(this,void 0,void 0,(function*(){return this.stream.entries().where(t,e).get()}))}create(t){return n(this,void 0,void 0,(function*(){return this.newCriteria().newInstance(t).save()}))}save(t){return n(this,void 0,void 0,(function*(){return t.save()}))}delete(t){return n(this,void 0,void 0,(function*(){return yield this.http.deleteEntry(this.stream.id,t.id),!0}))}truncate(){return this}newInstance(t){return this.newCriteria().newInstance(t)}newCriteria(){return new gt(this.stream)}}class $t{constructor(t,e,r,n){this.streams=t,this.meta=r,this.links=n,e.fields&&(this.fields=new Map(Object.entries(e.fields).map((([t,e])=>[t,new mt(e)]))),delete e.fields),Object.assign(this,e)}get repository(){return this._repository||(this._repository=new Et(this)),this._repository}entries(){return this.repository.newCriteria()}}class kt{constructor(t){this.config=t,this.hooks={all:new et(["data"]),make:new et(["data"]),maked:new Z(["stream"]),create:new et(["data"]),created:new Z(["stream"])},this.client=new t.Client(this.config),this.http=new t.Http(this)}all(){return n(this,void 0,void 0,(function*(){const t=yield this.http.getStreams(),e=[];for(let r of t.data){r=yield this.hooks.all.promise(r);const t=new $t(this,r);e.push(t)}return e}))}make(t){return n(this,void 0,void 0,(function*(){const e=yield this.http.getStream(t);yield this.hooks.make.promise(e.data);const r=new $t(this,e.data,e.meta,e.links);return this.hooks.maked.call(r),r}))}create(t,e){return n(this,void 0,void 0,(function*(){const r=yield this.http.postStream(Object.assign({id:t,name:t},e));yield this.hooks.create.promise(r.data);const n=new $t(this,r.data,r.meta,r.links);return this.hooks.created.call(n),n}))}entries(t){return n(this,void 0,void 0,(function*(){const e=yield this.make(t);return new gt(e)}))}repository(t){return n(this,void 0,void 0,(function*(){const e=yield this.make(t);return new Et(e)}))}collection(){}}export{ct as Client,ht as Collection,gt as Criteria,lt as Entry,pt as EntryCollection,mt as Field,wt as FieldCollection,rt as HTTPError,bt as Http,Q as Method,ft as PaginatedEntryCollection,Et as Repository,ut as RequestFactory,nt as Str,$t as Stream,kt as Streams,dt as comparisonOperators,yt as logicalOperators,st as objectify,_t as operators};
