"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("deepmerge"),e=require("util");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),o=n(e),s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},s(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var u=function(){return u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},u.apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{a(r.next(t))}catch(e){s(e)}}function u(t){try{a(r.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,u)}a((r=r.apply(t,e||[])).next())}))}function c(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(u){s=[6,u],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}var h=function(){function t(t,e,n){return void 0===e&&(e={}),void 0===n&&(n=!0),this._stream=t,this._data=e,this._fresh=n,new Proxy(this,{get:function(t,e,n){return Reflect.has(t,e)?Reflect.get(t,e,n):Reflect.has(t._data,e)?Reflect.get(t._data,e):void 0},set:function(t,e,n,r){return Reflect.has(t,e)?Reflect.set(t,e,n,r):Reflect.set(t._data,e,n)}})}return Object.defineProperty(t.prototype,"http",{get:function(){return this._stream.streams.http},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),t.prototype.save=function(){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this._fresh?[4,this.http.postEntry(this._stream.id,this._data)]:[3,2];case 1:case 3:return t.sent(),[2,!0];case 2:return[4,this.http.patchEntry(this._stream.id,this._data.id,this._data)];case 4:return t.sent(),[2,!1];case 5:return[2]}}))}))},t.prototype.validator=function(){},t}(),p=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=t.apply(this,e)||this;return Object.setPrototypeOf(r,Array.prototype),r}return i(e,t),e}(Array),l=function(t){function e(e,n,r){var o=t.apply(this,e)||this;return o.meta=n,o.links=r,o}return i(e,t),e.fromResponse=function(t,n){return new e(Object.values(t.data).map((function(t){return new h(n,t,!1)})),t.meta,t.links)},e}(p),f=function(t){function e(e,n,r){var o=t.apply(this,e)||this;return o.meta=n,o.links=r,o}return i(e,t),e.fromResponse=function(t,n){return new e(Object.values(t.data).map((function(t){return new h(n,t,!1)})),t.meta,t.links)},e}(p),d=[">","<","==","!=",">=","<=","!<","!>","<>"],y=["BETWEEN","EXISTS","OR","AND","NOT","IN","ALL","ANY","LIKE","IS NULL","UNIQUE"],v=[].concat(d).concat(y),m=function(t){return v.includes(t)},_=function(){function t(t){this.stream=t,this.parameters=[]}return Object.defineProperty(t.prototype,"http",{get:function(){return this.stream.streams.http},enumerable:!1,configurable:!0}),t.prototype.find=function(t){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.where("id",t).first()]}))}))},t.prototype.first=function(){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.limit(1).get()];case 1:return[2,t.sent()[0]]}}))}))},t.prototype.cache=function(){return this},t.prototype.orderBy=function(t,e){return void 0===e&&(e="desc"),this.addParameter("orderBy",[t,e]),this},t.prototype.limit=function(t){return this.addParameter("limit",t),this},t.prototype.where=function(){for(var t,e,n,r,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];if(2===o.length?(t=o[0],e="==",n=o[1]):3===o.length?(t=o[0],e=o[1],n=o[2]):4===o.length&&(t=o[0],e=o[1],n=o[2],r=o[3]),!m(e))throw new Error('Criteria where() operator "'+e+'" not valid ');return this.addParameter("where",[t,e,n,r]),this},t.prototype.orWhere=function(){for(var t,e,n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];if(2===r.length?(t=r[0],e="==",n=r[1]):(t=r[0],e=r[1],n=r[2]),!m(e))throw new Error('Criteria orWhere() operator "'+e+'" not valid ');return this.addParameter("where",[t,e,n,"or"]),this},t.prototype.get=function(){return a(this,void 0,void 0,(function(){var t,e;return c(this,(function(n){switch(n.label){case 0:return t=this.compileStatements(),[4,this.http.getEntries(this.stream.id,{query:t},{})];case 1:return e=n.sent(),[2,l.fromResponse(e,this.stream)]}}))}))},t.prototype.create=function(t){return a(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return[4,(e=this.newInstance(t)).save()];case 1:return n.sent(),[2,e]}}))}))},t.prototype.save=function(t){return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,t.save()];case 1:return[2,e.sent()]}}))}))},t.prototype.delete=function(){return this},t.prototype.paginate=function(t,e){return void 0===t&&(t=100),void 0===e&&(e=1),a(this,void 0,void 0,(function(){var n,r;return c(this,(function(o){switch(o.label){case 0:return n=this.compileStatements(),[4,this.http.getEntries(this.stream.id,{query:n},{paginate:!0,per_page:t,page:e})];case 1:return r=o.sent(),[2,f.fromResponse(r,this.stream)]}}))}))},t.prototype.newInstance=function(t){return new h(this.stream,t,!0)},t.prototype.getParameters=function(){return this.parameters},t.prototype.setParameters=function(t){return this.parameters=t,this},t.prototype.addParameter=function(t,e){return this.parameters.push({name:t,value:e}),this},t.prototype.compileStatements=function(){return this.parameters.map((function(t){var e,n;return(e={})[t.name]=(n=t.value,Array.isArray(n)?n:[n]),e}))},t}();const g=o.default.deprecate((()=>{}),"Hook.context is deprecated and will be removed"),w=function(...t){return this.call=this._createCall("sync"),this.call(...t)},b=function(...t){return this.callAsync=this._createCall("async"),this.callAsync(...t)},E=function(...t){return this.promise=this._createCall("promise"),this.promise(...t)};class ${constructor(t=[],e){this._args=t,this.name=e,this.taps=[],this.interceptors=[],this._call=w,this.call=w,this._callAsync=b,this.callAsync=b,this._promise=E,this.promise=E,this._x=void 0,this.compile=this.compile,this.tap=this.tap,this.tapAsync=this.tapAsync,this.tapPromise=this.tapPromise}compile(t){throw new Error("Abstract: should be overridden")}_createCall(t){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:t})}_tap(t,e,n){if("string"==typeof e)e={name:e.trim()};else if("object"!=typeof e||null===e)throw new Error("Invalid tap options");if("string"!=typeof e.name||""===e.name)throw new Error("Missing name for tap");void 0!==e.context&&g(),e=Object.assign({type:t,fn:n},e),e=this._runRegisterInterceptors(e),this._insert(e)}tap(t,e){this._tap("sync",t,e)}tapAsync(t,e){this._tap("async",t,e)}tapPromise(t,e){this._tap("promise",t,e)}_runRegisterInterceptors(t){for(const e of this.interceptors)if(e.register){const n=e.register(t);void 0!==n&&(t=n)}return t}withOptions(t){const e=e=>Object.assign({},t,"string"==typeof e?{name:e}:e);return{name:this.name,tap:(t,n)=>this.tap(e(t),n),tapAsync:(t,n)=>this.tapAsync(e(t),n),tapPromise:(t,n)=>this.tapPromise(e(t),n),intercept:t=>this.intercept(t),isUsed:()=>this.isUsed(),withOptions:t=>this.withOptions(e(t))}}isUsed(){return this.taps.length>0||this.interceptors.length>0}intercept(t){if(this._resetCompilation(),this.interceptors.push(Object.assign({},t)),t.register)for(let e=0;e<this.taps.length;e++)this.taps[e]=t.register(this.taps[e])}_resetCompilation(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}_insert(t){let e;this._resetCompilation(),"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let n=0;"number"==typeof t.stage&&(n=t.stage);let r=this.taps.length;for(;r>0;){r--;const t=this.taps[r];this.taps[r+1]=t;const o=t.stage||0;if(e){if(e.has(t.name)){e.delete(t.name);continue}if(e.size>0)continue}if(!(o>n)){r++;break}}this.taps[r]=t}}Object.setPrototypeOf($.prototype,null);var R=$;var x=class{constructor(t){this.config=t,this.options=void 0,this._args=void 0}create(t){let e;switch(this.init(t),this.options.type){case"sync":e=new Function(this.args(),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:t=>`throw ${t};\n`,onResult:t=>`return ${t};\n`,resultReturns:!0,onDone:()=>"",rethrowIfPossible:!0}));break;case"async":e=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.contentWithInterceptors({onError:t=>`_callback(${t});\n`,onResult:t=>`_callback(null, ${t});\n`,onDone:()=>"_callback();\n"}));break;case"promise":let t=!1;const n=this.contentWithInterceptors({onError:e=>(t=!0,`_error(${e});\n`),onResult:t=>`_resolve(${t});\n`,onDone:()=>"_resolve();\n"});let r="";r+='"use strict";\n',r+=this.header(),r+="return new Promise((function(_resolve, _reject) {\n",t&&(r+="var _sync = true;\n",r+="function _error(_err) {\n",r+="if(_sync)\n",r+="_resolve(Promise.resolve().then((function() { throw _err; })));\n",r+="else\n",r+="_reject(_err);\n",r+="};\n"),r+=n,t&&(r+="_sync = false;\n"),r+="}));\n",e=new Function(this.args(),r)}return this.deinit(),e}setup(t,e){t._x=e.taps.map((t=>t.fn))}init(t){this.options=t,this._args=t.args.slice()}deinit(){this.options=void 0,this._args=void 0}contentWithInterceptors(t){if(this.options.interceptors.length>0){const e=t.onError,n=t.onResult,r=t.onDone;let o="";for(let t=0;t<this.options.interceptors.length;t++){const e=this.options.interceptors[t];e.call&&(o+=`${this.getInterceptor(t)}.call(${this.args({before:e.context?"_context":void 0})});\n`)}return o+=this.content(Object.assign(t,{onError:e&&(t=>{let n="";for(let e=0;e<this.options.interceptors.length;e++){this.options.interceptors[e].error&&(n+=`${this.getInterceptor(e)}.error(${t});\n`)}return n+=e(t),n}),onResult:n&&(t=>{let e="";for(let n=0;n<this.options.interceptors.length;n++){this.options.interceptors[n].result&&(e+=`${this.getInterceptor(n)}.result(${t});\n`)}return e+=n(t),e}),onDone:r&&(()=>{let t="";for(let e=0;e<this.options.interceptors.length;e++){this.options.interceptors[e].done&&(t+=`${this.getInterceptor(e)}.done();\n`)}return t+=r(),t})})),o}return this.content(t)}header(){let t="";return this.needContext()?t+="var _context = {};\n":t+="var _context;\n",t+="var _x = this._x;\n",this.options.interceptors.length>0&&(t+="var _taps = this.taps;\n",t+="var _interceptors = this.interceptors;\n"),t}needContext(){for(const t of this.options.taps)if(t.context)return!0;return!1}callTap(t,{onError:e,onResult:n,onDone:r,rethrowIfPossible:o}){let s="",i=!1;for(let a=0;a<this.options.interceptors.length;a++){const e=this.options.interceptors[a];e.tap&&(i||(s+=`var _tap${t} = ${this.getTap(t)};\n`,i=!0),s+=`${this.getInterceptor(a)}.tap(${e.context?"_context, ":""}_tap${t});\n`)}s+=`var _fn${t} = ${this.getTapFn(t)};\n`;const u=this.options.taps[t];switch(u.type){case"sync":o||(s+=`var _hasError${t} = false;\n`,s+="try {\n"),s+=n?`var _result${t} = _fn${t}(${this.args({before:u.context?"_context":void 0})});\n`:`_fn${t}(${this.args({before:u.context?"_context":void 0})});\n`,o||(s+="} catch(_err) {\n",s+=`_hasError${t} = true;\n`,s+=e("_err"),s+="}\n",s+=`if(!_hasError${t}) {\n`),n&&(s+=n(`_result${t}`)),r&&(s+=r()),o||(s+="}\n");break;case"async":let i="";i+=n?`(function(_err${t}, _result${t}) {\n`:`(function(_err${t}) {\n`,i+=`if(_err${t}) {\n`,i+=e(`_err${t}`),i+="} else {\n",n&&(i+=n(`_result${t}`)),r&&(i+=r()),i+="}\n",i+="})",s+=`_fn${t}(${this.args({before:u.context?"_context":void 0,after:i})});\n`;break;case"promise":s+=`var _hasResult${t} = false;\n`,s+=`var _promise${t} = _fn${t}(${this.args({before:u.context?"_context":void 0})});\n`,s+=`if (!_promise${t} || !_promise${t}.then)\n`,s+=`  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise${t} + ')');\n`,s+=`_promise${t}.then((function(_result${t}) {\n`,s+=`_hasResult${t} = true;\n`,n&&(s+=n(`_result${t}`)),r&&(s+=r()),s+=`}), function(_err${t}) {\n`,s+=`if(_hasResult${t}) throw _err${t};\n`,s+=e(`_err${t}`),s+="});\n"}return s}callTapsSeries({onError:t,onResult:e,resultReturns:n,onDone:r,doneReturns:o,rethrowIfPossible:s}){if(0===this.options.taps.length)return r();const i=this.options.taps.findIndex((t=>"sync"!==t.type)),u=n||o;let a="",c=r,h=0;for(let p=this.options.taps.length-1;p>=0;p--){const n=p;c!==r&&("sync"!==this.options.taps[n].type||h++>20)&&(h=0,a+=`function _next${n}() {\n`,a+=c(),a+="}\n",c=()=>`${u?"return ":""}_next${n}();\n`);const o=c,l=t=>t?"":r(),f=this.callTap(n,{onError:e=>t(n,e,o,l),onResult:e&&(t=>e(n,t,o,l)),onDone:!e&&o,rethrowIfPossible:s&&(i<0||n<i)});c=()=>f}return a+=c(),a}callTapsLooping({onError:t,onDone:e,rethrowIfPossible:n}){if(0===this.options.taps.length)return e();const r=this.options.taps.every((t=>"sync"===t.type));let o="";r||(o+="var _looper = (function() {\n",o+="var _loopAsync = false;\n"),o+="var _loop;\n",o+="do {\n",o+="_loop = false;\n";for(let s=0;s<this.options.interceptors.length;s++){const t=this.options.interceptors[s];t.loop&&(o+=`${this.getInterceptor(s)}.loop(${this.args({before:t.context?"_context":void 0})});\n`)}return o+=this.callTapsSeries({onError:t,onResult:(t,e,n,o)=>{let s="";return s+=`if(${e} !== undefined) {\n`,s+="_loop = true;\n",r||(s+="if(_loopAsync) _looper();\n"),s+=o(!0),s+="} else {\n",s+=n(),s+="}\n",s},onDone:e&&(()=>{let t="";return t+="if(!_loop) {\n",t+=e(),t+="}\n",t}),rethrowIfPossible:n&&r}),o+="} while(_loop);\n",r||(o+="_loopAsync = true;\n",o+="});\n",o+="_looper();\n"),o}callTapsParallel({onError:t,onResult:e,onDone:n,rethrowIfPossible:r,onTap:o=((t,e)=>e())}){if(this.options.taps.length<=1)return this.callTapsSeries({onError:t,onResult:e,onDone:n,rethrowIfPossible:r});let s="";s+="do {\n",s+=`var _counter = ${this.options.taps.length};\n`,n&&(s+="var _done = (function() {\n",s+=n(),s+="});\n");for(let i=0;i<this.options.taps.length;i++){const u=()=>n?"if(--_counter === 0) _done();\n":"--_counter;",a=t=>t||!n?"_counter = 0;\n":"_counter = 0;\n_done();\n";s+="if(_counter <= 0) break;\n",s+=o(i,(()=>this.callTap(i,{onError:e=>{let n="";return n+="if(_counter > 0) {\n",n+=t(i,e,u,a),n+="}\n",n},onResult:e&&(t=>{let n="";return n+="if(_counter > 0) {\n",n+=e(i,t,u,a),n+="}\n",n}),onDone:!e&&(()=>u()),rethrowIfPossible:r})),u,a)}return s+="} while(false);\n",s}args({before:t,after:e}={}){let n=this._args;return t&&(n=[t].concat(n)),e&&(n=n.concat(e)),0===n.length?"":n.join(", ")}getTapFn(t){return`_x[${t}]`}getTap(t){return`_taps[${t}]`}getInterceptor(t){return`_interceptors[${t}]`}};const P=x;new class extends P{content({onError:t,onDone:e,rethrowIfPossible:n}){return this.callTapsSeries({onError:(e,n)=>t(n),onDone:e,rethrowIfPossible:n})}};const k=x;new class extends k{content({onError:t,onResult:e,resultReturns:n,onDone:r,rethrowIfPossible:o}){return this.callTapsSeries({onError:(e,n)=>t(n),onResult:(t,n,r)=>`if(${n} !== undefined) {\n${e(n)};\n} else {\n${r()}}\n`,resultReturns:n,onDone:r,rethrowIfPossible:o})}};const T=R,I=x;const O=new class extends I{content({onError:t,onResult:e,resultReturns:n,rethrowIfPossible:r}){return this.callTapsSeries({onError:(e,n)=>t(n),onResult:(t,e,n)=>{let r="";return r+=`if(${e} !== undefined) {\n`,r+=`${this._args[0]} = ${e};\n`,r+="}\n",r+=n(),r},onDone:()=>e(this._args[0]),doneReturns:n,rethrowIfPossible:r})}},A=()=>{throw new Error("tapAsync is not supported on a SyncWaterfallHook")},S=()=>{throw new Error("tapPromise is not supported on a SyncWaterfallHook")},D=function(t){return O.setup(this,t),O.create(t)};function C(t=[],e){if(t.length<1)throw new Error("Waterfall hooks must have at least one argument");const n=new T(t,e);return n.constructor=C,n.tapAsync=A,n.tapPromise=S,n.compile=D,n}C.prototype=null;var j=C;const q=x;new class extends q{content({onError:t,onDone:e,rethrowIfPossible:n}){return this.callTapsLooping({onError:(e,n)=>t(n),onDone:e,rethrowIfPossible:n})}};const H=x;new class extends H{content({onError:t,onDone:e}){return this.callTapsParallel({onError:(e,n,r,o)=>t(n)+o(!0),onDone:e})}};const L=x;new class extends L{content({onError:t,onResult:e,onDone:n}){let r="";return r+=`var _results = new Array(${this.options.taps.length});\n`,r+="var _checkDone = function() {\n",r+="for(var i = 0; i < _results.length; i++) {\n",r+="var item = _results[i];\n",r+="if(item === undefined) return false;\n",r+="if(item.result !== undefined) {\n",r+=e("item.result"),r+="return true;\n",r+="}\n",r+="if(item.error) {\n",r+=t("item.error"),r+="return true;\n",r+="}\n",r+="}\n",r+="return false;\n",r+="}\n",r+=this.callTapsParallel({onError:(t,e,n,r)=>{let o="";return o+=`if(${t} < _results.length && ((_results.length = ${t+1}), (_results[${t}] = { error: ${e} }), _checkDone())) {\n`,o+=r(!0),o+="} else {\n",o+=n(),o+="}\n",o},onResult:(t,e,n,r)=>{let o="";return o+=`if(${t} < _results.length && (${e} !== undefined && (_results.length = ${t+1}), (_results[${t}] = { result: ${e} }), _checkDone())) {\n`,o+=r(!0),o+="} else {\n",o+=n(),o+="}\n",o},onTap:(t,e,n,r)=>{let o="";return t>0&&(o+=`if(${t} >= _results.length) {\n`,o+=n(),o+="} else {\n"),o+=e(),t>0&&(o+="}\n"),o},onDone:n}),r}};const M=x;new class extends M{content({onError:t,onDone:e}){return this.callTapsSeries({onError:(e,n,r,o)=>t(n)+o(!0),onDone:e})}};const U=x;new class extends U{content({onError:t,onResult:e,resultReturns:n,onDone:r}){return this.callTapsSeries({onError:(e,n,r,o)=>t(n)+o(!0),onResult:(t,n,r)=>`if(${n} !== undefined) {\n${e(n)}\n} else {\n${r()}}\n`,resultReturns:n,onDone:r})}};const W=x;new class extends W{content({onError:t,onDone:e}){return this.callTapsLooping({onError:(e,n,r,o)=>t(n)+o(!0),onDone:e})}};const N=x;new class extends N{content({onError:t,onResult:e}){return this.callTapsSeries({onError:(e,n,r,o)=>t(n)+o(!0),onResult:(t,e,n)=>{let r="";return r+=`if(${e} !== undefined) {\n`,r+=`${this._args[0]} = ${e};\n`,r+="}\n",r+=n(),r},onDone:()=>e(this._args[0])})}};const F=o.default,B=(t,e)=>e;class z{constructor(t,e){this._map=new Map,this.name=e,this._factory=t,this._interceptors=[]}get(t){return this._map.get(t)}for(t){const e=this.get(t);if(void 0!==e)return e;let n=this._factory(t);const r=this._interceptors;for(let o=0;o<r.length;o++)n=r[o].factory(t,n);return this._map.set(t,n),n}intercept(t){this._interceptors.push(Object.assign({factory:B},t))}}z.prototype.tap=F.deprecate((function(t,e,n){return this.for(t).tap(e,n)}),"HookMap#tap(key,…) is deprecated. Use HookMap#for(key).tap(…) instead."),z.prototype.tapAsync=F.deprecate((function(t,e,n){return this.for(t).tapAsync(e,n)}),"HookMap#tapAsync(key,…) is deprecated. Use HookMap#for(key).tapAsync(…) instead."),z.prototype.tapPromise=F.deprecate((function(t,e,n){return this.for(t).tapPromise(e,n)}),"HookMap#tapPromise(key,…) is deprecated. Use HookMap#for(key).tapPromise(…) instead.");var G,X=j;exports.Method=void 0,(G=exports.Method||(exports.Method={})).connect="CONNECT",G.delete="DELETE",G.get="GET",G.head="HEAD",G.options="OPTIONS",G.patch="PATCH",G.post="POST",G.put="PUT",G.trace="TRACE";var J=function(t){function e(e){var n=t.call(this,"HTTP "+e.status+" Error: "+e.statusText)||this;return n.response=e,n.name="HTTPError",n}return i(e,t),e}(Error),K=function(){function t(){}return t.random=function(t){void 0===t&&(t=15);for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},t.ensureLeft=function(t,e){return!1===t.startsWith(e)?e+t:t},t.ensureRight=function(t,e){return!1===t.endsWith(e)?t+e:t},t.stripLeft=function(t,e){return t.startsWith(e)?t.substr(e.length):t},t.stripRight=function(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t},t.ucfirst=function(t){return t[0].toUpperCase()+t.slice(1)},t.lcfirst=function(t){return t[0].toLowerCase()+t.slice(1)},t.parameters=function(t,e){return Object.entries(e).forEach((function(e){var n=e[1];return t=t.replace(new RegExp(":"+e[0],"g"),n)})),t},t}(),Q=function(){function t(t){this.hooks={createRequest:new X(["factory"]),request:new X(["request"]),response:new X(["response","request"])},this.config=r.default({headers:{"X-Requested-With":"XMLHttpRequest"},request:{method:"GET",credentials:"include"}},t)}return t.prototype.request=function(t,e,n){return void 0===n&&(n={}),a(this,void 0,void 0,(function(){var r,o;return c(this,(function(s){switch(s.label){case 0:return r=this.createRequest(t,e,n),[4,this.hooks.request.promise(r)];case 1:return r=s.sent(),[4,fetch(r)];case 2:return o=s.sent(),[4,this.hooks.response.promise(o,r)];case 3:if(!(o=s.sent()).ok)throw new J(o);return[2,o]}}))}))},t.prototype.createRequest=function(t,e,n){void 0===n&&(n={});var r=this.createRequestFactory(t,e,n);return(r=this.hooks.createRequest.call(r)).make()},t.prototype.createRequestFactory=function(t,e,n){return void 0===n&&(n={}),(n=this.getRequestConfig(n)).method=exports.Method[t],function(t,e){void 0===e&&(e=Request);return new Y(t,e)}(this.config).merge(n)},t.prototype.getRequestConfig=function(t){return void 0===t&&(t={}),r.default(this.config.request,t,{clone:!0})},t}(),Y=function(){function t(t,e){return this._clientConfig=t,this._Request=e,this._config={},this._params=new URLSearchParams,this._headers=new Headers,new Proxy(this,{get:function(t,e,n){return Reflect.has(t,e)?Reflect.get(t,e,n):function(n){return t._config[e]=n,t}},set:function(t,e,n,r){return"function"==typeof t[e]?t[e](n):Reflect.set(t,e,n,r)}})}return t.prototype.merge=function(t){var e=this;return Object.entries(t).forEach((function(t){return e[t[0]](t[1])})),this},t.prototype.getConfig=function(){return u(u({},this._config),{headers:this._headers,params:this._params,url:this._config.url?this.getUri(this._config.url):this._config.url})},t.prototype.header=function(t,e){return this._headers.set(t,e),this},t.prototype.param=function(t,e){return this._headers.set(t,e),this},t.prototype.headers=function(t){var e;return e=this._headers,new Headers(t).forEach((function(t,n){return e.set(n,t)})),this},t.prototype.params=function(t){var e;return e=this._params,new URLSearchParams(t).forEach((function(t,n){return e.set(n,t)})),this},t.prototype.data=function(t){return this._headers.set("Content-Type","application/json"),this._config.body=JSON.stringify(t),this},t.prototype.getUri=function(t){var e=this._params.toString();return e.length&&(e="?"+e),K.ensureRight(this._clientConfig.baseURL,"/")+K.stripLeft(t,"/")+e},t.prototype.basic=function(t,e){return this.authorization("Basic",btoa(t+":"+e))},t.prototype.bearer=function(t){return this.authorization("Bearer",t)},t.prototype.authorization=function(t,e){return this._headers.set("Authorization",t+" "+e),this},t.prototype.make=function(){var t=this.getConfig();return new this._Request(t.url,t)},t}();var V=function(t){Object.assign(this,t)},Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(p),tt=function(){function t(t){this.streams=t}return Object.defineProperty(t.prototype,"client",{get:function(){return this.streams.client},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this.streams.config},enumerable:!1,configurable:!0}),t.prototype.getStreams=function(t,e){return void 0===t&&(t={}),void 0===e&&(e={}),a(this,void 0,void 0,(function(){return c(this,(function(n){return e.params=t,[2,this.get("/streams",e)]}))}))},t.prototype.postStream=function(t,e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.post("/streams",t,e)]}))}))},t.prototype.getStream=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return n.params=e,[2,this.get("/streams/"+t,n)]}))}))},t.prototype.patchStream=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.patch("/streams/"+t,e,n)]}))}))},t.prototype.putStream=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.put("/streams/"+t,e,n)]}))}))},t.prototype.deleteStream=function(t,e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.delete("/streams/"+t,e)]}))}))},t.prototype.getEntries=function(t,e,n,r){return void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r={}),a(this,void 0,void 0,(function(){return c(this,(function(o){return r.body=e,r.params=n,[2,this.get("/streams/"+t+"/entries",u(u({},r),{headers:{"Content-Type":"application/json"}}))]}))}))},t.prototype.postEntry=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.post("/streams/"+t+"/entries",e,n)]}))}))},t.prototype.getEntry=function(t,e,n){return void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.get("/streams/"+t+"/entries/"+e,n)]}))}))},t.prototype.patchEntry=function(t,e,n,r){return void 0===n&&(n={}),void 0===r&&(r={}),a(this,void 0,void 0,(function(){return c(this,(function(o){return[2,this.patch("/streams/"+t+"/entries/"+e,n,r)]}))}))},t.prototype.putEntry=function(t,e,n,r){return void 0===n&&(n={}),void 0===r&&(r={}),a(this,void 0,void 0,(function(){return c(this,(function(o){return[2,this.put("/streams/"+t+"/entries/"+e,n,r)]}))}))},t.prototype.deleteEntry=function(t,e,n){return void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return K.parameters("/streams/:stream/entries/:entry",{stream:t,entry:e}),[2,this.patch("/streams/"+t+"/entries/"+e,n)]}))}))},t.prototype.get=function(t,e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.request("get",t,e)]}))}))},t.prototype.delete=function(t,e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.request("delete",t,e)]}))}))},t.prototype.head=function(t,e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.request("head",t,e)]}))}))},t.prototype.options=function(t,e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.request("options",t,e)]}))}))},t.prototype.post=function(t,e,n){return void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.request("post",t,u({data:e},n))]}))}))},t.prototype.put=function(t,e,n){return void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.request("put",t,u({data:e},n))]}))}))},t.prototype.patch=function(t,e,n){return void 0===n&&(n={}),a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.request("patch",t,u({data:e},n))]}))}))},t.prototype.request=function(t,e,n){return a(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.client.request(t,e,n)];case 1:return[2,r.sent()];case 2:throw r.sent();case 3:return[2]}}))}))},t}(),et=function(){function t(t){this.stream=t}return Object.defineProperty(t.prototype,"http",{get:function(){return this.stream.streams.http},enumerable:!1,configurable:!0}),t.prototype.all=function(){return a(this,void 0,void 0,(function(){var t,e,n=this;return c(this,(function(r){switch(r.label){case 0:return[4,this.http.getEntries(this.stream.id)];case 1:return t=r.sent(),e=t.data.map((function(t){return new h(n.stream,t,!1)})),[2,new l(e,t.meta,t.links)]}}))}))},t.prototype.find=function(t){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.stream.entries().where("id",t).first()]}))}))},t.prototype.findAll=function(t){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.stream.entries().where("id","IN",t).get()]}))}))},t.prototype.findBy=function(t,e){return a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.stream.entries().where(t,e).first()]}))}))},t.prototype.findAllWhere=function(t,e){return a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.stream.entries().where(t,e).get()]}))}))},t.prototype.create=function(t){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.newCriteria().newInstance(t).save()]}))}))},t.prototype.save=function(t){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2,t.save()]}))}))},t.prototype.delete=function(t){return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.http.deleteEntry(this.stream.id,t.id)];case 1:return e.sent(),[2,!0]}}))}))},t.prototype.truncate=function(){return this},t.prototype.newInstance=function(t){return this.newCriteria().newInstance(t)},t.prototype.newCriteria=function(){return new _(this.stream)},t}(),nt=function(){function t(t,e,n,r){this.streams=t,this.meta=n,this.links=r,e.fields&&(this.fields=new Map(Object.entries(e.fields).map((function(t){return[t[0],new V(t[1])]}))),delete e.fields),Object.assign(this,e)}return Object.defineProperty(t.prototype,"repository",{get:function(){return this._repository||(this._repository=new et(this)),this._repository},enumerable:!1,configurable:!0}),t.prototype.entries=function(){return this.repository.newCriteria()},t}(),rt=function(){function t(t){this.config=t,this.client=new Q(this.config),this.http=new tt(this)}return t.prototype.all=function(){return a(this,void 0,void 0,(function(){var t=this;return c(this,(function(e){switch(e.label){case 0:return[4,this.http.getStreams()];case 1:return[2,e.sent().data.map((function(e){return new nt(t,e)}))]}}))}))},t.prototype.make=function(t){return a(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return[4,this.http.getStream(t)];case 1:return e=n.sent(),[2,new nt(this,e.data,e.meta,e.links)]}}))}))},t.prototype.create=function(t,e){return a(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return[4,this.http.postStream(u({id:t,name:t},e))];case 1:return n=r.sent(),[2,new nt(this,n.data,n.meta,n.links)]}}))}))},t.prototype.entries=function(t){return a(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return[4,this.make(t)];case 1:return e=n.sent(),[2,new _(e)]}}))}))},t.prototype.repository=function(t){return a(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return[4,this.make(t)];case 1:return e=n.sent(),[2,new et(e)]}}))}))},t.prototype.collection=function(){},t}();exports.Client=Q,exports.Collection=p,exports.Criteria=_,exports.Entry=h,exports.EntryCollection=l,exports.Field=V,exports.FieldCollection=Z,exports.Http=tt,exports.PaginatedEntryCollection=f,exports.Repository=et,exports.RequestFactory=Y,exports.Stream=nt,exports.Streams=rt,exports.comparisonOperators=d,exports.logicalOperators=y,exports.operators=v;
